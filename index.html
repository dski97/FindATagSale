<!DOCTYPE html>
<html lang="en">
<head>
  <title>Tag Sale Locator</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
  <meta name="description" content="" />

  <!-- calls for the arcgis api's CSS file and JS library. -->
  <link rel="stylesheet" href="https://js.arcgis.com/4.25/esri/themes/light/main.css">
  <script src="https://js.arcgis.com/4.25/"></script>

  <!-- Adding the modules, API key, and map constant needed for a full screen map app-->
  <script>
    window.onload = function() {
    var modal = document.getElementById("myModal");
    var span = document.getElementsByClassName("close")[0];

    // When the page loads, open the modal 
    modal.style.display = "block";

    // When the user clicks on <span> (x), close the modal
    span.onclick = function() {
      modal.style.display = "none";
    }

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function(event) {
      if (event.target == modal) {
        modal.style.display = "none";
      }
    }
  }


    require([
      "esri/config",
      "esri/Map",
      "esri/views/MapView",
      "esri/widgets/BasemapGallery",
      "esri/widgets/Locate",
      "esri/widgets/Search",
      "esri/widgets/Expand",
      "esri/Graphic",
      "esri/layers/GraphicsLayer",
      "esri/geometry/Polyline",
      "esri/geometry/Polygon",
      "esri/layers/FeatureLayer",
      "esri/widgets/Editor",
      "esri/widgets/Legend"
    ], function(esriConfig, Map, MapView, BasemapGallery, Locate, Search, Expand, Graphic, GraphicsLayer,
       Polyline, Polygon, FeatureLayer, Editor, Legend) {

      esriConfig.apiKey = "AAPK0401ef0eec41482c8aa0f4e7b5b118c24q7q7NIv8wbHpLPAB-Gvij3hfV_lpqWtqNzqcjDlMqJCmQc5meuAETYsSI2KOgu_";
      const map = new Map({
        basemap: "arcgis-topographic" // Basemap layer
      });

      //view of connecticut
      const view = new MapView({
        map: map,
        center: [-72.7, 41.62], // Longitude, latitude
        zoom: 9, // Zoom level
        container: "viewDiv" // Div element
      });


      //adding the const for the graphics layer
      const graphicsLayer = new GraphicsLayer();
      map.add(graphicsLayer);

      //adding the const for the point for mount everest
      const point = {
        type: "point",
        longitude: 86.925,
        latitude: 27.988
      };

      //add the code to define the style for the point
      const simpleMarkerSymbol = {
        type: "simple-marker",
        style: "square",
        size: "20px",
        color: [226, 119, 40], // Orange
        outline: {
          color: [255, 255, 255], // White
          width: 2
        }
      };

       //define the popup template
       const popupTemplate = {
        title: "{Name}",
        content: "{Description}"
      }
      const attributes = {
        Name: "Mount Everest",
        Description: "The highest mountain in the world (Elevation of 29,035ft.)"
      }

      //point together the geometry with the symbol to create a graphic
      const pointGraphic = new Graphic({
        geometry: point,
        symbol: simpleMarkerSymbol,
        attributes: attributes,
        popupTemplate: popupTemplate
      });

      //add the graphic to the view
      graphicsLayer.add(pointGraphic);

        //Define a popup template for the feature layer
        const featureLayerPopupTemplate = {
          title: "Places of Worship",
          content: "<b>Name:</b> {name} <br><b>Class:</b> {fclass} <br><b>District:</b> {district}"
        }


        // Create a FeatureLayer from a service (place of worship)
        const placesofworship = new FeatureLayer({
          url: "https://livingatlas.esri.in/server/rest/services/Place_of_Worship/FeatureServer",
      
        //add the popup template to the feature layer
        outFields: ["name", "fclass", "district"],
        popupTemplate: featureLayerPopupTemplate
        });

        // Add the feature layer to the map
        map.add(placesofworship);

        //add the feature layer for ct towns
        const ct_polygons = new FeatureLayer({
        url: "https://services1.arcgis.com/FjPcSmEFuDYlIdKC/ArcGIS/rest/services/Connecticut_and_Vicinity_Town_Boundary_Set/FeatureServer/1"
        });
        
        map.add(ct_polygons);
        //disable the labels for the ct towns
        ct_polygons.labelingInfo = [];
        //set the definition expression for the ct towns
        ct_polygons.definitionExpression = "STATE_COD = 'CT' AND LAND_CLASS <> 'Water'";
        //configure the popup for the ct towns
        ct_polygons.popupTemplate = {
          title: "{TOWN_NAME}",
        }

        //add the other donation centers feature layer
        const otherDonationCenters = new FeatureLayer({
        url: "https://services5.arcgis.com/pdfXHSYV8F56tWCx/ArcGIS/rest/services/USA_DGR_Operators/FeatureServer/0"
        });
        map.add(otherDonationCenters);
        //set the defintion expression for the other donation centers
        otherDonationCenters.definitionExpression = "STATE = 'CT'";
        otherDonationCenters.popupTemplate = {
          title: "Donation Center: {CONAME}",
          content: "The Donation Center <b>{CONAME}</b> is located on <b>{STREET}</b> in <b>{CITY}</b>."
        }

        const goodwillDonationCenters = new FeatureLayer({
          url: "https://services.arcgis.com/HRPe58bUyBqyyiCt/ArcGIS/rest/services/USA_Goodwill_Locations/FeatureServer/0"
          });
          map.add(goodwillDonationCenters);
          //set the defintion expression for the other donation centers
          goodwillDonationCenters.definitionExpression = "STATE = 'CT'";
          goodwillDonationCenters.popupTemplate = {
            title: "Goodwill Donation Center: {ADDRESS}",
            content: "This Goodwill Donation Center <b>{NAME}</b> is located on <b>{match_addr}</b>. <br> <br> This store opened on <b>{OPENDATE}.<b/>"
          }

          const tagsales_fc = new FeatureLayer({
            url: "https://services.arcgis.com/HRPe58bUyBqyyiCt/arcgis/rest/services/survey123_453b28a5c1164c4db099d02150f858f9_results/FeatureServer/0"
          });
          map.add(tagsales_fc);
          

  
        //define the popup template for the feature layer (transport)
        const featureLayerPopupTemplate_transport = {
          title: "Transport",
          content: "<b>Name:</b> {name} <br><b>Class:</b> {fclass} <br><b>District:</b> {district}"
        }

        //define the popup template for the editable feature layer (airport)
        const featureLayerPopupTemplate_airport = {
          title: "Airport Visited",
          content: "<b>Airport Code:</b> {AirportCode}"
        }
        
        //const to make airport labels
        const airportLabels = {
          symbol: {
            type: "text",
            color: "#FFFFFF",
            haloColor: "#5E8D74",
            haloSize: "2px",
            font: {
              size: 12,
              family: "Noto Sans",
              style: "italic",
              weight: "normal"
            }
          },
          labelPlacement: "above-center",
          labelExpressionInfo: {
            expression: "$feature.name"
          }
        };

        //const for helicopter labels
        const helicopterLabels = {
          symbol: {
            type: "text",
            color: "#FFFFFF",
            haloColor: "#1A5276",
            haloSize: "2px",
            font: {
              size: 12,
              family: "Noto Sans",
              style: "italic",
              weight: "normal"
            }
          },
          labelPlacement: "above-center",
          labelExpressionInfo: {
            expression: "$feature.name"
          }
        };

        //const for airport visited labels
        const airportVisitedLabels = {
          symbol: {
            type: "text",
            color: "#FFFFFF",
            haloColor: "#8B0000",
            haloSize: "2px",
            font: {
              size: 12,
              family: "Noto Sans",
              style: "italic",
              weight: "normal"
            }
          },
          labelPlacement: "below-center",
          labelExpressionInfo: {
            expression: "$feature.AirportCode"
          }
        };

        //const for icon airport
        const airportRenderer = {
          type: "simple",
          symbol: {
            type: "picture-marker",
            url: "https://dski97.github.io/agol-dom/outline_local_airport_black_24dp.png",
            width: "18px",
            height: "18px"
          }
        };

        //const for icon helicopter
        const helicopterRenderer = {
          type: "simple",
          symbol: {
            type: "picture-marker",
            url: "https://dski97.github.io/agol-dom/heliport.png",
            width: "18px",
            height: "18px"
          }};

          //const for icon airport visited
        const airportVisitedRenderer = {
          type: "simple",
          symbol: {
            type: "picture-marker",
            url: "https://dski97.github.io/agolrest-dom/outline_download_done_black_24dp.png",
            width: "18px",
            height: "18px"
          }
        };

        // Create a FeatureLayer from a service (transport) - airport
        const transportAirport = new FeatureLayer({
          url: "https://services.arcgis.com/HRPe58bUyBqyyiCt/arcgis/rest/services/Transport/FeatureServer",
          renderer: airportRenderer,
          definitionExpression: "fclass = 'Airport'",
          outFields: ["name", "fclass", "district"],
          labelingInfo: [airportLabels],
          popupTemplate: featureLayerPopupTemplate_transport,
          title: "Airports"
        });
        
        // Create a FeatureLayer from a service (transport) - helicopter
        const transportHelicopter = new FeatureLayer({
          url: "https://services.arcgis.com/HRPe58bUyBqyyiCt/arcgis/rest/services/Transport/FeatureServer",
          renderer: helicopterRenderer,
          definitionExpression: "fclass = 'Helipad'",
          outFields: ["name", "fclass", "district"],
          labelingInfo: [helicopterLabels],
          popupTemplate: featureLayerPopupTemplate_transport,
          title: "Helipads"
        });
      
        // Add the feature layer to the map
        map.add(transportAirport);
        map.add(transportHelicopter);
  

      // Expand widget for basemap gallery
      const bgExpand = new Expand({
        view: view,
        content: new BasemapGallery({
          view: view
        })
      });
      view.ui.add(bgExpand, "top-right");
    

      // Create a Locate widget instance and add it to the view
      const locate = new Locate({
        view: view
      });
      view.ui.add(locate, "top-left");

      // Create a Search widget instance and add it to the view
      const searchWidget = new Search({
        view: view
      });
      view.ui.add(searchWidget, {
        position: "top-left",
        index: 2
      });

      // Create a Legend widget instance and add it to the view
      const legend = new Legend({
        view: view
      });

      const legendExpand = new Expand({
        view: view,
        content: legend,
        expandIconClass: "esri-icon-layer-list",
        expandTooltip: "Legend",
        expanded: true
      });
      view.ui.add(legendExpand, "bottom-left");
    });

     
  </script>



  <!-- css to make a full screen map-->
    <style>
      html,
      body,
      #viewDiv {
        padding: 0;
        margin: 0;
        height: calc(100% - 15px);
        width: 100%;
      }
      #heading {
      padding: 0;
      margin: 0;
      height: 100%;
      width: 100%;
      background-color: #0098db;
    }

    .header {
      text-align: left;
      background: #267a6a;
      color: rgb(255, 255, 255);
      height: 44px;
      display: flex;
      align-items: center;
      font-weight: bolder;
      font-size: 10pt;
      padding-left: 10px;
    }
      .modal {
      display: none; /* Hidden by default */
      position: fixed; /* Stay in place */
      z-index: 1; /* Sit on top */
      padding-top: 100px; /* Location of the box */
      left: 0;
      top: 0;
      width: 100%; /* Full width */
      height: 100%; /* Full height */
      overflow: auto; /* Enable scroll if needed */
      background-color: rgb(82, 36, 36); /* Fallback color */
      background-color: rgba(141, 30, 30, 0.4); /* Black w/ opacity */
      text-align: center;
      }

      .modal-content {
        background-color: #e7e7e7;
        margin: auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
      }

      .close {
        color: #aaaaaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
      }

      .close:hover,
      .close:focus {
        color: #000;
        text-decoration: none;
        cursor: pointer;
      }

    </style>

</head>
<body>
  <!-- the div to display the header-->
  <div class = "header">
    <h1>Tag Sale Locator</h1>
  </div>
  <!-- the div to displays the map-->
  <div id="viewDiv"></div>
  <!-- the div to add modal-->
  <div id="myModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <img src ="tag-sale.jpg" alt="Tag Sale!" width="300" height="153">
        <h2>Welcome to the Tag Sale Locator App!</h2>
        <p>This interactive tool is designed to help you discover tag sales happening in your area. Use this app to find great deals, rare treasures, and unique items sold at local tag sales. Here are some features you can take advantage of:</p>
        <ul>
            <li><strong>Search Functionality:</strong> Use the search bar at the top left corner of the map to search for a specific area or address. The map will show you any tag sales happening in that location.</li>
            <li><strong>Locate Button:</strong> Want to see tag sales near your current location? Click on the locate button at the top left corner of the map to center the view on your current location.</li>
            <li><strong>Basemap Gallery:</strong> Want a different view? Click on the basemap icon at the top right corner to change the map's appearance to best suit your preference.</li>
            <li><strong>Legend:</strong> Not sure what the symbols on the map mean? Click on the legend button at the bottom left corner for a breakdown of all the symbols used on the map.</li>
        </ul>
        <p>Start exploring now and find your next treasure at a tag sale near you! Click on the 'X' or anywhere outside this box to close this message and start using the application.</p>
    </div>
</div>


</body>
</html>